Программатор на Arduino для контроллера батареи ноутбука (BQ20Z955) - AS10D81
Этот проект представляет собой программу для Arduino, предназначенную для взаимодействия с контроллерами Smart Battery, такими как TI BQ20Z955, используемыми в батареях ноутбуков (например, AS10D81). Программа позволяет считывать важные данные о состоянии батареи и выполнять операции обслуживания через шину SMBus (System Management Bus), которая базируется на I2C.

Ключевые особенности
SMBus-коммуникация: Устанавливает связь с микросхемой Smart Battery с помощью стандартной библиотеки Arduino Wire.

Получение информации о батарее: Считывает и отображает широкий спектр данных о батарее, включая:

Расчетная емкость (Design Capacity), Полная емкость заряда (Full Charge Capacity), Количество циклов (Cycle Count)

Дата производства, Расчетное напряжение (Design Voltage)

Имя производителя (ManufName), Имя устройства (DeviceName), Серийный номер (SerialNumber), Химический состав устройства (DeviceChemistry)

Ток/напряжение зарядки, Температура, Мгновенное напряжение/ток

Состояние заряда (относительное и абсолютное)

Напряжение отдельных ячеек (VCELL1-VCELL4)

Различные статусы: Статус батареи (Battery Status), Статус операции (Operation Status), Статус безопасности (Safety Status), Статус постоянной ошибки (PFStatus), Статус зарядки (Charging Status), Управление FET (FET Control), Статус производителя (Manufacturer Status), Идентификатор химии (Chemistry ID) и Режим батареи (Battery Mode).

Операции по обслуживанию батареи: Предоставляет интерактивное меню для выполнения таких действий, как:

Сброс батареи (Pack Reset): Выполняет программный сброс батарейного блока.

Разблокировка (Unsealing): Разблокирует батарею, позволяя выполнять операции записи (требуются специфические ключи).

Режим полного доступа (Full Access Mode): Переводит батарею в режим полного доступа для расширенных операций.

Очистка постоянной ошибки (Clear Permanent Failure - PF): Сбрасывает флаги постоянных ошибок, которые могли возникнуть.

Очистка количества циклов (Clear Cycle Count): Сбрасывает счетчик циклов батареи на ноль.

Установка текущей даты (Set Current Date): Обновляет дату производства, хранящуюся в микросхеме батареи, используя дату компиляции скетча.

Запись DesignCapacity, QMAX, Update Status, Ra_table: Позволяет перекалибровать и обновить критически важные параметры батареи, включая расчетную емкость (Design Capacity) и значения Qmax для каждой ячейки. Также сбрасывает флаг статуса обновления и записывает стандартную таблицу R_a (таблицу сопротивлений).

Запуск алгоритма отслеживания импеданса (Begin Impedance Track Algorithm): Инициирует алгоритм отслеживания импеданса батареи, который критически важен для точной оценки состояния заряда (SOC) и состояния здоровья батареи.

Требования
Плата Arduino (например, Uno, Mega, Nano).

Батарея со Smart Battery контроллером (например, BQ20Z955).

Подключение SMBus (SDA, SCL) от Arduino к соответствующим пинам на контроллере батареи.

Важно: Необходимо модифицировать библиотеку Wire Arduino для увеличения размера буфера до 34 байт (0x22). Это требуется для корректной работы с блочными операциями чтения/записи по протоколу SMBus. Изменения должны быть внесены в файлы Wire.h и utility/twi.h в вашей установке Arduino IDE.

Использование
Подключите ваш Arduino к контактам SMBus контроллера батареи (SDA к A4, SCL к A5 на Uno/Nano, или соответствующие пины на других платах).

Модифицируйте библиотеку Wire как описано выше.

Откройте файл SmartBattery.ino в Arduino IDE.

При необходимости измените new_capacity, unseal_key_1, unseal_key_2, full_access_key_1, full_access_key_2, pf_clear_key_1, pf_clear_key_2 в соответствии с вашей батареей. Будьте осторожны, некорректные ключи могут заблокировать батарею.

Загрузите скетч на вашу плату Arduino.

Откройте Последовательный монитор (Serial Monitor) в Arduino IDE (скорость 9600 бод).

Следуйте инструкциям в меню, отображаемом в Последовательном мониторе, для выполнения различных операций.
